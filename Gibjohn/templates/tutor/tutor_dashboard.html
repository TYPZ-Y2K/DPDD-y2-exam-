{% extends "base.html" %}
{% block title %}Tutor Dashboard — GibJohn Tutoring{% endblock %}

{% block content %}
<meta http-equiv="refresh" content="60">
<section class="td-top">
<h1>Hi {{ current_user.full_name or "Tutor" }}.</h1>

<div class="kpi-wrap">
<div class="kpi">
    <span class="kpi-label">Active classes</span>
    <span class="kpi-value">{{ kpi_active_classes }}</span>
</div>
<div class="kpi">
    <span class="kpi-label">Total Students</span>
    <span class="kpi-value">{{ kpi_students }}</span>
</div>
<div class="kpi">
    <span class="kpi-label">Assignments</span>
    <span class="kpi-value">{{ kpi_assignments }}</span>
</div>
</div>
</section>

<section class="td-grid">
<!-- Left column -->
<div class="td-main">
<!-- My classes -->
<div class="card">
    <h2>My classes</h2>
    <div class="class-cards">
    {% for c in classes %}
        <article class="class-card">
        <h3 class="class-title">{{ c.title }}</h3>
        <p class="class-sub">{{ c.students }} students</p>
        <div class="meter small">
            <div class="bar" role="progressbar"
                aria-valuemin="0" aria-valuemax="100"
                aria-valuenow="{{ c.progress }}">
            <div class="fill" style="--p: {{ c.progress }}%"></div>
            <span class="pct">{{ c.progress }}%</span>
            </div>
        </div>
        <a href="#" class="btn btn-ghost">View Students</a>
        </article>
    {% else %}
        <p class="muted">No classes yet. <a href="{{ url_for('tutor.new_class') }}">Create one</a>.</p>
    {% endfor %}
    </div>
</div>

<!-- Assignments table -->
<div class="card">
    <h2>Assignments</h2>
    <div class="table-wrap">
    <table class="table">
        <caption class="sr-only">Recent assignments with due dates and submission counts</caption>
        <thead>
        <tr>
            <th scope="col">Assignment</th>
            <th scope="col">Due</th>
            <th scope="col">Submissions</th>
            <th scope="col"><span class="sr-only">Open</span></th>
        </tr>
        </thead>
        <tbody>
        {% for a in assignments %}
            <tr>
            <td>{{ a.title }}</td>
            <td>
{% if a.due_date %}
{{ a.due_date|dt }}
{% elif a.due %}
{{ a.due }}
{% else %}—{% endif %}
</td>

            <td>{{ a.submissions }}</td>
            <td class="t-right"><a href="{{ a.link }}" aria-label="Open {{ a.title }}">›</a></td>
            </tr>
        {% else %}
            <tr><td colspan="4">No assignments yet.</td></tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
</div>
</div>

<!-- Right column -->
<aside class="td-side">
<div class="card">
    <h2>Recent Activity</h2>
    <div class="activity" role="status" aria-live="polite">
    {% for item in recent %}
        <p class="activity-item">{{ item }}</p>
    {% else %}
        <p class="muted">No recent activity.</p>
    {% endfor %}
    </div>
</div>

<div class="card">
    <h2>Leaderboard</h2>
    <ul class="leaderboard">
    {% for row in leaderboard %}
        <li><span>{{ row.name }}</span><span class="lb-xp">{{ row.xp }}</span></li>
    {% else %}
        <li><span>No data yet</span><span class="lb-xp">0 XP</span></li>
    {% endfor %}
    </ul>
    <a class="btn btn-primary block" href="{{ url_for('tutor.assignments') }}">Create new assignments</a>
</div>
</aside>
</section>
{% endblock %}
